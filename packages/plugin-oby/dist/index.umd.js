(function(W,V){typeof exports=="object"&&typeof module<"u"?module.exports=V(require("signaldb")):typeof define=="function"&&define.amd?define(["signaldb"],V):(W=typeof globalThis<"u"?globalThis:W||self,W.SignalDB=V(W.signaldb))})(this,function(W){"use strict";const V=Symbol("Cached"),te=Symbol("Observable"),Je=Symbol("Observable.Boolean"),Ye=Symbol("Observable.Frozen"),me=Symbol("Observable.Readable"),Te=Symbol("Observable.Writable"),se=Symbol("Store"),Fe=Symbol("Store.Keys"),Ve=Symbol("Store.Observable"),ae=Symbol("Store.Target"),xe=Symbol("Store.Values"),Me=Symbol("Store.Untracked"),z=Symbol("Suspense"),ze=Symbol("Uncached"),Be=Symbol("Untracked"),He=Symbol("Untracked.Unwrapped"),Et=e=>Q(e)?e:[e],wt=e=>e instanceof Error?e:typeof e=="string"?new Error(e):new Error("Unknown error"),{is:H}=Object,{isArray:Q}=Array,yt=(e,t)=>{if(e.length!==t.length)return!1;for(let s=0,n=e.length;s<n;s++){const r=e[s],i=t[s];if(!H(r,i))return!1}return!0},O=e=>typeof e=="function",Pe=e=>e!==null&&typeof e=="object",Ot=e=>typeof e=="symbol",Ie=()=>{},Ge=()=>!1;function _t(){if(arguments.length)throw new Error("A readonly Observable can not be updated");return this}function Rt(){if(arguments.length)throw new Error("A readonly Observable can not be updated");return this.get()}function mt(e){return arguments.length?O(e)?this.C(e):this.set(e):this.get()}const C=e=>{const t=_t.bind(e);return t[te]=!0,t[Ye]=!0,t},q=e=>{const t=Rt.bind(e);return t[te]=!0,t[me]=e,t},$e=e=>{const t=mt.bind(e);return t[te]=!0,t[Te]=e,t},je=0,Ae=1,de=2,be=3,We=C(!1),Tt=C(!0),Ne=new Proxy({},new Proxy({},{get(){throw new Error("Unavailable value")}})),Xe=function(){},Le=(e,t)=>{if(e instanceof Array)for(let s=0,n=e.length;s<n;s++)t(e[s]);else e&&t(e)},ge=(e,t)=>{if(e instanceof Array)for(let s=e.length-1;s>=0;s--)t(e[s]);else e&&t(e)},ne=(e,t,s)=>{const n=e[t];n instanceof Array?n.push(s):n?e[t]=[n,s]:e[t]=s},J=(e,t,s)=>{const n=e[t];if(n instanceof Set)n.add(s);else if(n){if(s!==n){const r=new Set;r.add(n),r.add(s),e[t]=r}}else e[t]=s},Y=(e,t,s)=>{const n=e[t];n instanceof Set?n.delete(s):n===s&&(e[t]=void 0)},re=(e,t)=>{if(e instanceof Set)for(const s of e)t(s);else e&&t(e)},xt=e=>e.call(e),Ce=e=>e.Q(!0);class ie{constructor(){this.disposed=!1,this.B=void 0,this.S=void 0,this.D=void 0,this.K=void 0,this.T=void 0,this.U=void 0}catch(t,s){var r;const{S:n}=this;if(n)return n(t),!0;if((r=this.parent)!=null&&r.catch(t,!0))return!0;if(s)return!1;throw t}Q(t){ge(this.D,Ce),ge(this.K,Ce),ge(this.U,Ce),ge(this.B,xt),this.B=void 0,this.disposed=t,this.S=void 0,this.K=void 0,this.U=void 0}get(t){var s;return(s=this.context)==null?void 0:s[t]}E(t,s,n){const r=d,i=F;tt(s),pe(n);try{return t()}catch(o){return this.catch(wt(o),!1),Ne}finally{tt(r),pe(i)}}}class Ze extends ie{constructor(){super(...arguments),this.context={}}}let X,ke=new Ze,F,d=ke;const et=e=>X=e,pe=e=>F=e,tt=e=>d=e;let Se=0,st=Ie;const Mt=async e=>{Se||et(new Promise(t=>st=t));try{return Se+=1,await e()}finally{Se-=1,Se||(et(void 0),st())}},nt=e=>O(e)&&Je in e,oe=e=>{var t,s;return O(e)&&(Ye in e||!!((s=(t=e[me])==null?void 0:t.parent)!=null&&s.disposed))},Ke=e=>O(e)&&(Be in e||He in e);let Bt=class{constructor(){this.A1=[],this.M=0,this.A2=!1,this.N=()=>{if(!this.A2&&!this.M&&this.A1.length)try{for(this.A2=!0;;){const t=this.A1;if(!t.length)break;this.A1=[];for(let s=0,n=t.length;s<n;s++)t[s].C()}}finally{this.A2=!1}},this.E=t=>{this.M+=1,t(),this.M-=1,this.N()},this.F=t=>{this.A1.push(t)}}};const ce=new Bt;class P{constructor(t,s,n){this.K=new Set,this.value=t,n&&(this.parent=n),(s==null?void 0:s.equals)!==void 0&&(this.equals=s.equals||Ge)}get(){var t,s;return(t=this.parent)!=null&&t.disposed||((s=this.parent)==null||s.C(),F==null||F.A.L(this)),this.value}set(t){const s=this.equals||H;return(this.value===Xe||!s(t,this.value))&&(this.value=t,ce.M+=1,this.I(be),ce.M-=1,ce.N()),t}I(t){for(const s of this.K)(s.J!==Ae||s.A.has(this))&&(s.sync?(s.J=Math.max(s.J,t),ce.F(s)):s.I(t))}C(t){const s=t(this.value);return this.set(s)}}class Pt{constructor(t){this.observer=t,this.A=[],this.P=0}Q(t){if(t){const{observer:s,A:n}=this;for(let r=0;r<n.length;r++)n[r].K.delete(s)}this.P=0}R(){const{observer:t,A:s,P:n}=this,r=s.length;if(n<r){for(let i=n;i<r;i++)s[i].K.delete(t);s.length=n}}empty(){return!this.A.length}has(t){const s=this.A.indexOf(t);return s>=0&&s<this.P}L(t){const{observer:s,A:n,P:r}=this,i=n.length;if(i>0){if(n[r]===t){this.P+=1;return}const o=n.indexOf(t);if(o>=0&&o<r)return;r<i-1?this.R():r===i-1&&n[r].K.delete(s)}t.K.add(s),n[this.P++]=t,r===128&&(s.A=new It(s,n))}C(){var s;const{A:t}=this;for(let n=0,r=t.length;n<r;n++)(s=t[n].parent)==null||s.C()}}class It{constructor(t,s){this.observer=t,this.A=new Set(s)}Q(t){for(const s of this.A)s.K.delete(this.observer)}R(){}empty(){return!this.A.size}has(t){return this.A.has(t)}L(t){const{observer:s,A:n}=this,r=n.size;t.K.add(s);const i=n.size;r!==i&&n.add(t)}C(){var t;for(const s of this.A)(t=s.parent)==null||t.C()}}class Ue extends ie{constructor(){super(),this.parent=d,this.context=d.context,this.J=be,this.A=new Pt(this),d!==ke&&ne(this.parent,"K",this)}Q(t){this.A.Q(t),super.Q(t)}H(t){this.Q(!1),this.J=Ae;try{return this.E(t,this,this)}finally{this.A.R()}}run(){throw new Error("Abstract method")}I(t){throw new Error("Abstract method")}C(){this.disposed||(this.J===de&&this.A.C(),this.J===be?(this.J=Ae,this.run(),this.J===Ae?this.J=je:this.C()):this.J=je)}}class Nt extends Ue{constructor(t,s){super(),this.fn=t,this.observable=new P(Xe,s,this),(s==null?void 0:s.sync)===!0&&(this.sync=!0,this.C())}run(){const t=super.H(this.fn);!this.disposed&&this.A.empty()&&(this.disposed=!0),t!==Ne&&this.observable.set(t)}I(t){const s=this.J;s>=t||(this.J=t,s!==de&&this.observable.I(de))}}const I=(e,t)=>{if(oe(e))return e;if(Ke(e))return C(e());{const s=new Nt(e,t);return q(s.observable)}},ve=e=>{if(O(e)){if(oe(e)||Ke(e))return!!e();if(nt(e))return e;{const t=I(()=>!!e());return t[Je]=!0,t}}else return!!e},U=e=>{ne(d,"B",e)};class Lt extends ie{constructor(t){super(),this.parent=d,this.context={...d.context,...t},ne(this.parent,"D",this)}E(t){return super.E(t,this,void 0)}}function Ct(e,t){return Ot(e)?d.context[e]:new Lt(e).E(t||Ie)}const Kt=()=>{const e=new P(!1);return U(()=>e.set(!0)),q(e)};class Ut{constructor(){this.A1=[],this.A2=!1,this.A3=!1,this.N=()=>{if(!this.A2&&this.A1.length)try{for(this.A2=!0;;){const t=this.A1;if(!t.length)break;this.A1=[];for(let s=0,n=t.length;s<n;s++)t[s].C()}}finally{this.A2=!1}},this.queue=()=>{this.A3||(this.A3=!0,this.resolve())},this.resolve=()=>{queueMicrotask(()=>{queueMicrotask(()=>{X?X.finally(this.resolve):(this.A3=!1,this.N())})})},this.F=t=>{this.A1.push(t),this.queue()}}}const Ee=new Ut;class rt extends Ue{constructor(t,s){if(super(),this.fn=t,(s==null?void 0:s.suspense)!==!1){const n=this.get(z);n&&(this.suspense=n)}(s==null?void 0:s.sync)===!0&&(this.sync=!0),(s==null?void 0:s.sync)==="init"?(this.init=!0,this.C()):this.F()}run(){const t=super.H(this.fn);O(t)&&ne(this,"B",t)}F(){var t;(t=this.suspense)!=null&&t.suspended||(this.sync?this.C():Ee.F(this))}I(t){const s=this.J;s>=t||(this.J=t,(!this.sync||s!==2&&s!==3)&&this.F())}C(){var t;(t=this.suspense)!=null&&t.suspended||super.C()}}const we=(e,t)=>{const s=new rt(e,t);return()=>s.Q(!0)};function y(e){if(O(e))return He in e?y(e()):Be in e?C(y(e())):te in e?e:I(()=>y(e()));if(e instanceof Array){const t=new Array(e.length);for(let s=0,n=t.length;s<n;s++)t[s]=y(e[s]);return t}else return e}class ye extends ie{constructor(t){super(),this.parent=d,this.context=d.context,t&&this.get(z)&&(this.A0=!0,J(this.parent,"T",this))}Q(t){this.A0&&Y(this.parent,"T",this),super.Q(t)}E(t){const s=()=>this.Q(!0),n=()=>t(s);return super.E(n,this,void 0)}}const vt=C(-1);let Dt=class extends ye{};class Qt{constructor(t){this.parent=d,this.suspense=d.get(z),this.A5=new Map,this.A6=!1,this.A7=0,this.A8=0,this.A9=0,this.cleanup=()=>{if(!this.A7||this.A7===this.A8)return;const{A5:s,A6:n}=this;s.size&&(this.A9?s.forEach((r,i)=>{r.A6!==n&&(r.Q(!0),s.delete(i))}):(this.A5.forEach(r=>{r.Q(!0)}),this.A5=new Map))},this.Q=()=>{this.suspense&&Y(this.parent,"T",this.T),this.A7=this.A5.size,this.A8=0,this.A9=0,this.cleanup()},this.AA=()=>{this.A6=!this.A6,this.A8=0,this.A9=0},this.O=s=>{this.A9=s.length,this.cleanup(),this.A7=this.A9,this.A8=0},this.map=s=>{var A;this.AA();const{A5:n,A6:r,fn:i,AB:o}=this,u=new Array(s.length);let c=!0,h=!0,l=0;for(let f=0,p=s.length;f<p;f++){const b=s[f],g=n.get(b);if(g&&g.A6!==r)h=!1,l+=1,g.A6=r,(A=g.index)==null||A.set(f),u[f]=g.G;else{c=!1;const S=new Dt(!1);g&&U(()=>S.Q(!0)),S.E(()=>{let _=vt;o&&(S.index=new P(f),_=q(S.index));const ee=u[f]=y(i(b,_));S.A6=r,S.G=ee,g||n.set(b,S)})}}return this.A8=l,this.O(s),c&&(u[V]=!0),h&&(u[ze]=!0),u},this.T=()=>Array.from(this.A5.values()),this.fn=t,this.AB=t.length>1,this.suspense&&J(this.parent,"T",this.T)}}const De=e=>O(e)&&te in e;function Z(e,t=!0){return(t?O:De)(e)?e():e}class it extends ie{constructor(){var t;super(),this.parent=d,this.context={...d.context,[z]:this},ne(this.parent,"U",this),this.suspended=((t=d.get(z))==null?void 0:t.suspended)||0}A4(t){var c;if(!this.suspended&&!t)return;const s=this.suspended,n=s+(t?1:-1);if(this.suspended=n,!!s==!!n)return;(c=this.observable)==null||c.set(!!n);const r=h=>{Le(h.D,r),Le(h.K,i),Le(h.U,u),re(h.T,o)},i=h=>{h instanceof rt&&(h.J===de||h.J===be)&&(h.init?h.C():h.F()),r(h)},o=h=>{O(h)?h().forEach(r):r(h)},u=h=>{h.A4(t)};r(this)}E(t){return super.E(t,this,void 0)}}const ot=(e,t)=>{const s=new it,n=ve(e);return we(()=>s.A4(Z(n)),{sync:!0}),s.E(t)},qt=C(-1);class Jt extends ye{}class Yt{constructor(t,s){this.parent=d,this.suspense=d.get(z),this.A5=new Map,this.AC=[],this.AD=0,this.cleanup=()=>{let n=0,r=Math.max(0,this.pooled?this.AD-this.AC.length:0);this.A5.forEach(i=>{var o;r>0&&n++<r?((o=i.suspended)==null||o.set(!0),this.AC.push(i)):i.Q(!0)})},this.Q=()=>{this.suspense&&Y(this.parent,"T",this.T),this.A5.forEach(n=>{n.Q(!0)}),this.AC.forEach(n=>{n.Q(!0)})},this.map=n=>{var b,g,S,_,ee,Re;const{A5:r,fn:i,AB:o}=this,u=new Map,c=new Array(n.length),h=this.AC,l=this.pooled;let A=!0,f=!0,p=[];if(r.size)for(let T=0,w=n.length;T<w;T++){const x=n[T],M=r.get(x);M?(f=!1,r.delete(x),u.set(x,M),(b=M.index)==null||b.set(T),c[T]=M.G):p.push(T)}else p=new Array(c.length);e:for(let T=0,w=p.length;T<w;T++){const x=p[T]||T,M=n[x],$=u.has(M);if(!$)for(const[fe,j]of r.entries()){r.delete(fe),u.set(M,j),(g=j.index)==null||g.set(x),(S=j.value)==null||S.set(M),c[x]=j.G;continue e}A=!1;let m;l&&h.length?(m=h.pop(),(_=m.index)==null||_.set(x),(ee=m.value)==null||ee.set(M),(Re=m.suspended)==null||Re.set(!1),c[x]=m.G):(m=new Jt(!1),m.E(()=>{let fe=qt;o&&(m.index=new P(x),fe=q(m.index));const j=m.value=new P(M),qe=l?new P(!1):void 0,St=I(()=>Z(j.get())),Ss=c[x]=qe?ot(()=>qe.get(),()=>y(i(St,fe))):y(i(St,fe));m.value=j,m.G=Ss,m.suspended=qe})),$?U(()=>m.Q(!0)):u.set(M,m)}return this.AD=Math.max(this.AD,c.length),this.cleanup(),this.A5=u,A&&(c[V]=!0),f&&(c[ze]=!0),c},this.T=()=>[...this.A5.values(),...this.AC.values()],this.fn=t,this.AB=t.length>1,this.pooled=s,this.suspense&&J(this.parent,"T",this.T)}}const B=e=>Pe(e)&&se in e;function K(e){if(O(e)){const t=F;if(t)try{return pe(void 0),e()}finally{pe(t)}else return e()}else return e}function Ft(e,t,s=[],n){if(Q(e)&&!B(e)){const r=!!(n!=null&&n.unkeyed);return C(K(()=>e.length?e.map((i,o)=>y(t(r&&!De(i)?C(i):i,o))):y(s)))}else{const{Q:r,map:i}=n!=null&&n.unkeyed?new Yt(t,!!n.pooled):new Qt(t);U(r);const o=I(()=>Z(e)??[],{equals:(u,c)=>!!u&&!!c&&!u.length&&!c.length&&!B(u)&&!B(c)});return I(()=>{const u=o();return B(u)&&u[xe],K(()=>{const c=i(u);return c!=null&&c.length?c:y(s)})},{equals:(u,c)=>Q(u)&&!!u[V]&&Q(c)&&yt(u,c)})}}const ct=e=>(K(e),e),Qe=(e,t,s)=>{for(let n=0,r=t.length;n<r;n++){const i=t[n];if(i.length===1)return i[0];if(H(i[0],e))return i[1]}return s};function ut(e,t,s){if(O(e)&&!oe(e)&&!Ke(e)){if(nt(e))return I(()=>y(Qe(e(),t,s)));const r=ct(I(()=>Qe(e(),t,s)));return oe(r)?C(y(r())):I(()=>y(Z(r)))}else{const r=Qe(Z(e),t,s);return C(y(r))}}const lt=(e,t,s)=>{const n=ve(e);return ut(n,[[!0,t],[s]])};function Vt(e,t,s){return lt(e,t,s)}const ht=()=>!!X||Ee.A3||Ee.A2||ce.A2;function ft(e,t){return $e(new P(e,t))}const at=()=>{const e=d instanceof Ze,t=d instanceof ye,s=d instanceof it,n=d instanceof Ue;return{isSuperRoot:e,isRoot:t,isSuspense:s,isComputation:n}},zt=e=>O(e)&&Te in e,Ht=e=>O(e)?e[me]||e[Te]||Ne:e,Gt=e=>zt(e)?q(Ht(e)):e,$t=e=>new ye(!0).E(e);class jt extends Map{constructor(){super(...arguments),this.disposed=!1}}class Wt extends P{constructor(){super(...arguments),this.AE=1}call(){this.AF.disposed||(this.AE-=1,!this.AE&&this.AF.delete(this.AG))}}const Xt=e=>{if(e=ct(I(e)),oe(e)){const r=K(e);return i=>i===r?Tt:We}let t=new jt,s=K(e);return we(()=>{var o,u;const r=s,i=e();H(r,i)||(s=i,(o=t.get(r))==null||o.set(!1),(u=t.get(i))==null||u.set(!0))},{suspense:!1,sync:!0}),U(()=>{t.disposed=!0}),r=>{let i=t.get(r);return i?i.AE+=1:(i=new Wt(r===s),i.AF=t,i.AG=r,t.set(r,i)),U(i),q(i)}};class v extends Map{AH(t,s){return super.set(t,s),s}}class Oe{constructor(){this.AE=0}listen(){this.AE+=1,U(this)}call(){this.AE-=1,!this.AE&&this.Q()}Q(){}}class Zt extends Oe{constructor(t,s){super(),this.parent=t,this.observable=s}Q(){this.parent.keys=void 0}}class kt extends Oe{constructor(t,s){super(),this.parent=t,this.observable=s}Q(){this.parent.values=void 0}}class es extends Oe{constructor(t,s,n){super(),this.parent=t,this.key=s,this.observable=n}Q(){var t;(t=this.parent.has)==null||t.delete(this.key)}}class ts extends Oe{constructor(t,s,n,r){super(),this.parent=t,this.key=s,this.observable=n,this.AI=r}Q(){var t;(t=this.parent.AJ)==null||t.delete(this.key)}}const R={AK:0,AL:new Set,AM:new Set,AN:()=>{const{AL:e,AM:t}=R,s=new Set,n=r=>{s.has(r)||(s.add(r),re(r.AO,n),re(r.AP,i=>{e.add(i)}))};return t.forEach(n),()=>{e.forEach(r=>{r()})}},V:e=>{R.AM.add(e),N.F()},reset:()=>{R.AL=new Set,R.AM=new Set}},E={AK:0,AM:new Map,AN:()=>{const{AM:e}=E;return()=>{e.forEach((t,s)=>{const n=Array.from(t);re(s.AQ,r=>{r(n)})})}},V:(e,t)=>{const s=E.AM.get(e)||new Set;s.add(t),E.AM.set(e,s),N.F()},AR:(e,t,s)=>{if(t.AO){const n=new Set,r=i=>{n.has(i)||(n.add(i),re(i.AO,o=>{o.AO||E.V(o,i.store),r(o)}))};r(e||t)}else{const n=(e==null?void 0:e.store)||K(()=>t.store[s]);E.V(t,n)}},reset:()=>{E.AM=new Map}},N={AK:!1,N:()=>{const e=R.AN(),t=E.AN();N.reset(),e(),t()},AS:()=>{ht()?X?X.finally(N.AS):setTimeout(N.AS,0):N.N()},reset:()=>{N.AK=!1,R.reset(),E.reset()},F:()=>{N.AK||(N.AK=!0,queueMicrotask(N.AS))}},k=new WeakMap,ss=new Set([se,Fe,Ve,ae,xe]),ns=new Set(["__proto__","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","prototype","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toSource","toString","valueOf"]),At={get:(e,t)=>{var c,h;if(ss.has(t)){if(t===se)return!0;if(t===ae)return e;if(t===Fe){if(le()){const l=L(e);l.keys||(l.keys=bt(l)),l.keys.listen(),l.keys.observable.get()}return}if(t===xe){if(le()){const l=L(e);l.values||(l.values=is(l)),l.values.listen(),l.values.observable.get()}return}if(t===Ve)return l=>{var _;l=typeof l=="number"?String(l):l;const A=L(e),f=(_=A.AT)==null?void 0:_.get(l);if(f)return f.bind(A.store);A.AJ||(A.AJ=new v);const p=e[l],b=A.AJ.get(l)||A.AJ.AH(l,gt(A,l,p)),g=A.equals?{equals:A.equals}:void 0;return b.observable||(b.observable=ue(A,p,g)),q(b.observable)}}if(ns.has(t))return e[t];const s=L(e),n=(c=s.AT)==null?void 0:c.get(t),r=n||e[t];s.AJ||(s.AJ=new v);const i=le(),o=he(r),u=i||o?s.AJ.get(t)||s.AJ.AH(t,gt(s,t,r)):void 0;if(u!=null&&u.AI&&J(u.AI,"AO",s),u&&i){const l=s.equals?{equals:s.equals}:void 0;u.listen(),u.observable||(u.observable=ue(s,r,l)),u.observable.get()}return n?n.call(s.store):typeof r=="function"&&r===Array.prototype[t]?function(){return r.apply(s.store,arguments)}:((h=u==null?void 0:u.AI)==null?void 0:h.store)||r},set:(e,t,s)=>{var i,o,u,c,h,l,A,f,p,b;s=D(s);const n=L(e),r=(i=n.AU)==null?void 0:i.get(t);if(r)r.call(n.store,s);else{const g=Q(e),S=e[t],_=!!S||t in e,ee=n.equals||H;if(_&&ee(s,S)&&(t!=="length"||!g))return!0;const Re=g&&e.length;e[t]=s;const T=g&&e.length;g&&t!=="length"&&Re!==T&&((c=(u=(o=n.AJ)==null?void 0:o.get("length"))==null?void 0:u.observable)==null||c.set(T)),(h=n.values)==null||h.observable.set(0),_||((l=n.keys)==null||l.observable.set(0),(f=(A=n.has)==null?void 0:A.get(t))==null||f.observable.set(!0));const w=(p=n.AJ)==null?void 0:p.get(t);if(w!=null&&w.AI&&Y(w.AI,"AO",n),w&&((b=w.observable)==null||b.set(s),w.AI=he(s)?k.get(s)||_e(s,t,n):void 0),w!=null&&w.AI&&J(w.AI,"AO",n),E.AK&&E.AR(w==null?void 0:w.AI,n,t),R.AK&&R.V(n),g&&t==="length"){const x=Number(S),M=Number(s);for(let $=M;$<x;$++)$ in e||At.deleteProperty(e,`${$}`,!0)}}return!0},deleteProperty:(e,t,s)=>{var u,c,h,l,A,f,p,b;const n=t in e;if(!s&&!n)return!0;if(!Reflect.deleteProperty(e,t))return!1;const i=L(e);(u=i.AT)==null||u.delete(t),(c=i.AU)==null||c.delete(t),(h=i.keys)==null||h.observable.set(0),(l=i.values)==null||l.observable.set(0),(f=(A=i.has)==null?void 0:A.get(t))==null||f.observable.set(!1);const o=(p=i.AJ)==null?void 0:p.get(t);return E.AK&&E.AR(o==null?void 0:o.AI,i,t),o!=null&&o.AI&&Y(o.AI,"AO",i),o&&((b=o.observable)==null||b.set(void 0),o.AI=void 0),R.AK&&R.V(i),!0},defineProperty:(e,t,s)=>{var h,l,A,f,p,b,g,S;const n=L(e),r=n.equals||H,i=t in e,o=Reflect.getOwnPropertyDescriptor(e,t);if("value"in s&&B(s.value)&&(s={...s,value:D(s.value)}),o&&hs(o,s,r))return!0;if(!Reflect.defineProperty(e,t,s))return!1;s.get?s.get&&(n.AT||(n.AT=new v),n.AT.set(t,s.get)):(h=n.AT)==null||h.delete(t),s.set?s.set&&(n.AU||(n.AU=new v),n.AU.set(t,s.set)):(l=n.AU)==null||l.delete(t),i!==!!s.enumerable&&((A=n.keys)==null||A.observable.set(0)),(p=(f=n.has)==null?void 0:f.get(t))==null||p.observable.set(!0);const c=(b=n.AJ)==null?void 0:b.get(t);if(E.AK&&E.AR(c==null?void 0:c.AI,n,t),c!=null&&c.AI&&Y(c.AI,"AO",n),c)if("get"in s)(g=c.observable)==null||g.set(s.get),c.AI=void 0;else{const _=s.value;(S=c.observable)==null||S.set(_),c.AI=he(_)?k.get(_)||_e(_,t,n):void 0}return c!=null&&c.AI&&J(c.AI,"AO",n),E.AK&&E.AR(c==null?void 0:c.AI,n,t),R.AK&&R.V(n),!0},has:(e,t)=>{if(t===se||t===ae)return!0;const s=t in e;if(le()){const n=L(e);n.has||(n.has=new v);const r=n.has.get(t)||n.has.AH(t,os(n,t,s));r.listen(),r.observable.get()}return s},ownKeys:e=>{const t=Reflect.ownKeys(e);if(le()){const s=L(e);s.keys||(s.keys=bt(s)),s.keys.listen(),s.keys.observable.get()}return t}},rs={has:(e,t)=>t===Me?!0:t in e},_e=(e,t,s,n)=>{if(B(e))return L(D(e));const r=fs(e,t,s)?e:new Proxy(e,At),i=cs(e),o={AO:s,store:r};if(i){const{AT:u,AU:c}=i;u&&(o.AT=u),c&&(o.AU=c)}return n===!1?o.equals=Ge:n?o.equals=n:s!=null&&s.equals&&(o.equals=s.equals),k.set(e,o),o},L=e=>{const t=k.get(e);if(!t)throw new Error("Impossible");return t},dt=e=>L(D(e)),bt=e=>{const t=ue(e,0,{equals:!1});return new Zt(e,t)},is=e=>{const t=ue(e,0,{equals:!1});return new kt(e,t)},os=(e,t,s)=>{const n=ue(e,s);return new es(e,t,n)},ue=(e,t,s)=>new P(t,s),gt=(e,t,s)=>{const r=he(s)?k.get(s)||_e(s,t,e):void 0,i=new ts(e,t,void 0,r);return e.AJ||(e.AJ=new v),e.AJ.set(t,i),i},cs=e=>{if(Q(e))return;let t,s;const n=Object.keys(e);for(let r=0,i=n.length;r<i;r++){const o=n[r],u=Object.getOwnPropertyDescriptor(e,o);if(!u)continue;const{get:c,set:h}=u;c&&(t||(t=new v),t.set(o,c)),h&&(s||(s=new v),s.set(o,h)),c&&!h&&(s||(s=new v),s.set(o,as))}if(!(!t&&!s))return{AT:t,AU:s}},us=(e,t)=>B(e)?e:(k.get(e)||_e(e,void 0,void 0,t==null?void 0:t.equals)).store,D=e=>B(e)?e[ae]:e,ls=e=>!Pe(e)||pt(e)?e:new Proxy(e,rs),hs=(e,t,s)=>!!e.configurable==!!t.configurable&&!!e.enumerable==!!t.enumerable&&!!e.writable==!!t.writable&&s(e.value,t.value)&&e.get===t.get&&e.set===t.set,fs=(e,t,s)=>{if(Object.isFrozen(e))return!0;if(!s||t===void 0)return!1;const n=G.unwrap(s.store),r=Reflect.getOwnPropertyDescriptor(n,t);return!(r!=null&&r.configurable||r!=null&&r.writable)},le=()=>!!F,he=e=>{if(e===null||typeof e!="object")return!1;if(se in e)return!0;if(Me in e)return!1;if(Q(e))return!0;const t=Object.getPrototypeOf(e);return t===null?!0:Object.getPrototypeOf(t)===null},pt=e=>e===null||typeof e!="object"?!1:Me in e,as=()=>{throw new TypeError("Cannot set property value of #<Object> which has only a getter")},G=(e,t)=>!Pe(e)||pt(e)?e:us(e,t);G.on=(e,t)=>{const s=B(e)?[e]:Et(e),n=s.filter(O),r=s.filter(B).map(dt);R.AK+=1;const i=n.map(o=>{let u=!1;return we(()=>{u&&(R.AL.add(t),N.F()),u=!0,o()},{suspense:!1,sync:!0})});return r.forEach(o=>{J(o,"AP",t)}),()=>{R.AK-=1,i.forEach(o=>{o()}),r.forEach(o=>{Y(o,"AP",t)})}},G._onRoots=(e,t)=>{if(!B(e))return Ie;const s=dt(e);if(s.AO)throw new Error("Only top-level stores are supported");return E.AK+=1,J(s,"AQ",t),()=>{E.AK-=1,Y(s,"AQ",t)}},G.reconcile=(()=>{const e=r=>Q(r)?1:he(r)?2:0,t=(r,i)=>{const o=D(r),u=D(i);s(r,i);const c=e(o),h=e(u);return(c===1||h===1)&&(r.length=i.length),r},s=(r,i)=>{const o=D(r),u=D(i),c=Object.keys(o),h=Object.keys(u);for(let l=0,A=h.length;l<A;l++){const f=h[l],p=o[f],b=u[f];if(H(p,b))p===void 0&&!(f in o)&&(r[f]=void 0);else{const g=e(p),S=e(b);g&&g===S?(s(r[f],b),g===1&&(r[f].length=b.length)):r[f]=b}}for(let l=0,A=c.length;l<A;l++){const f=c[l];f in u||delete r[f]}return r};return(r,i)=>K(()=>t(r,i))})(),G.untrack=e=>ls(e),G.unwrap=e=>D(e);const As=()=>{const e=d.get(z);if(!e)return We;const t=e.observable||(e.observable=new P(!!e.suspended));return q(t)},ds=()=>{Ee.N()},bs=(e,t)=>{const s=ft();return I(()=>{const n=s();return n?y(t({error:n,reset:()=>s(void 0)})):(d.S=s,y(e))})};function gs(e){const t=O(e)?(...s)=>K(()=>e(...s)):()=>e;return t[Be]=!0,t}const ps=()=>{const e=d,t=F;return s=>e.E(()=>s(),e,t)};function a(e,t){return $e(new P(e,t))}return a.batch=Mt,a.boolean=ve,a.cleanup=U,a.context=Ct,a.disposed=Kt,a.effect=we,a.for=Ft,a.get=Z,a.if=Vt,a.isBatching=ht,a.isObservable=De,a.isStore=B,a.memo=I,a.observable=ft,a.owner=at,a.readonly=Gt,a.resolve=y,a.root=$t,a.selector=Xt,a.store=G,a.suspended=As,a.suspense=ot,a.switch=ut,a.ternary=lt,a.tick=ds,a.tryCatch=bs,a.untrack=K,a.untracked=gs,a.with=ps,W.createReactivityAdapter({create:()=>{const e=a(0);return{depend:()=>{e()},notify:()=>{e(K(()=>e()+1))}}},isInScope:()=>!!at(),onDispose:e=>{U(e)}})});
//# sourceMappingURL=index.umd.js.map
