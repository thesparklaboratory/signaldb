{"version":3,"file":"index.mjs","sources":["../src/index.ts"],"sourcesContent":["import { useRef, useReducer, useMemo, useEffect } from 'react';\nconst forceUpdateReducer = (x) => x + 1;\nconst useForceUpdate = () => useReducer(forceUpdateReducer, 0)[1];\n// eslint-disable-next-line import/prefer-default-export\nexport function createUseReactivityHook(effect) {\n    function useReactivity(reactiveFn, deps) {\n        const forceUpdate = useForceUpdate();\n        const refs = useRef({\n            isMounted: true,\n        });\n        const ensureComputation = () => {\n            if (refs.current.stopComputation) {\n                refs.current.stopComputation();\n                refs.current.stopComputation = undefined;\n            }\n            refs.current.stopComputation = effect(() => {\n                if (!refs.current.isMounted)\n                    return;\n                refs.current.data = reactiveFn();\n                forceUpdate();\n            });\n        };\n        useMemo(() => {\n            if (!refs.current.isMounted)\n                return;\n            ensureComputation();\n        }, deps || []);\n        useEffect(() => {\n            refs.current.isMounted = true;\n            if (!refs.current.stopComputation)\n                ensureComputation();\n            return () => {\n                refs.current.isMounted = false;\n                if (!refs.current.stopComputation)\n                    return;\n                refs.current.stopComputation();\n                refs.current.stopComputation = undefined;\n            };\n        }, []);\n        return refs.current.data;\n    }\n    return useReactivity;\n}\n"],"names":["forceUpdateReducer","x","useForceUpdate","useReducer","createUseReactivityHook","effect","useReactivity","reactiveFn","deps","forceUpdate","refs","useRef","ensureComputation","useMemo","useEffect"],"mappings":";AACA,MAAMA,IAAqB,CAACC,MAAMA,IAAI,GAChCC,IAAiB,MAAMC,EAAWH,GAAoB,CAAC,EAAE,CAAC;AAEzD,SAASI,EAAwBC,GAAQ;AACnC,WAAAC,EAAcC,GAAYC,GAAM;AACrC,UAAMC,IAAcP,EAAe,GAC7BQ,IAAOC,EAAO;AAAA,MAChB,WAAW;AAAA,IAAA,CACd,GACKC,IAAoB,MAAM;AACxB,MAAAF,EAAK,QAAQ,oBACbA,EAAK,QAAQ,gBAAgB,GAC7BA,EAAK,QAAQ,kBAAkB,SAE9BA,EAAA,QAAQ,kBAAkBL,EAAO,MAAM;AACpC,QAACK,EAAK,QAAQ,cAEbA,EAAA,QAAQ,OAAOH,EAAW,GACnBE,EAAA;AAAA,MAAA,CACf;AAAA,IACL;AACA,WAAAI,EAAQ,MAAM;AACN,MAACH,EAAK,QAAQ,aAEAE,EAAA;AAAA,IAAA,GACnBJ,KAAQ,CAAA,CAAE,GACbM,EAAU,OACNJ,EAAK,QAAQ,YAAY,IACpBA,EAAK,QAAQ,mBACIE,EAAA,GACf,MAAM;AAEL,MADJF,EAAK,QAAQ,YAAY,IACpBA,EAAK,QAAQ,oBAElBA,EAAK,QAAQ,gBAAgB,GAC7BA,EAAK,QAAQ,kBAAkB;AAAA,IACnC,IACD,EAAE,GACEA,EAAK,QAAQ;AAAA,EAAA;AAEjB,SAAAJ;AACX;"}