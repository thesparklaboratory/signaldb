{"version":3,"file":"index.umd.js","sources":["../src/index.ts"],"sourcesContent":["import { useRef, useReducer, useMemo, useEffect } from 'react';\nconst forceUpdateReducer = (x) => x + 1;\nconst useForceUpdate = () => useReducer(forceUpdateReducer, 0)[1];\n// eslint-disable-next-line import/prefer-default-export\nexport function createUseReactivityHook(effect) {\n    function useReactivity(reactiveFn, deps) {\n        const forceUpdate = useForceUpdate();\n        const refs = useRef({\n            isMounted: true,\n        });\n        const ensureComputation = () => {\n            if (refs.current.stopComputation) {\n                refs.current.stopComputation();\n                refs.current.stopComputation = undefined;\n            }\n            refs.current.stopComputation = effect(() => {\n                if (!refs.current.isMounted)\n                    return;\n                refs.current.data = reactiveFn();\n                forceUpdate();\n            });\n        };\n        useMemo(() => {\n            if (!refs.current.isMounted)\n                return;\n            ensureComputation();\n        }, deps || []);\n        useEffect(() => {\n            refs.current.isMounted = true;\n            if (!refs.current.stopComputation)\n                ensureComputation();\n            return () => {\n                refs.current.isMounted = false;\n                if (!refs.current.stopComputation)\n                    return;\n                refs.current.stopComputation();\n                refs.current.stopComputation = undefined;\n            };\n        }, []);\n        return refs.current.data;\n    }\n    return useReactivity;\n}\n"],"names":["forceUpdateReducer","x","useForceUpdate","useReducer","createUseReactivityHook","effect","useReactivity","reactiveFn","deps","forceUpdate","refs","useRef","ensureComputation","useMemo","useEffect"],"mappings":"mQACA,MAAMA,EAAsBC,GAAMA,EAAI,EAChCC,EAAiB,IAAMC,EAAA,WAAWH,EAAoB,CAAC,EAAE,CAAC,EAEzD,SAASI,EAAwBC,EAAQ,CACnC,SAAAC,EAAcC,EAAYC,EAAM,CACrC,MAAMC,EAAcP,EAAe,EAC7BQ,EAAOC,EAAAA,OAAO,CAChB,UAAW,EAAA,CACd,EACKC,EAAoB,IAAM,CACxBF,EAAK,QAAQ,kBACbA,EAAK,QAAQ,gBAAgB,EAC7BA,EAAK,QAAQ,gBAAkB,QAE9BA,EAAA,QAAQ,gBAAkBL,EAAO,IAAM,CACnCK,EAAK,QAAQ,YAEbA,EAAA,QAAQ,KAAOH,EAAW,EACnBE,EAAA,EAAA,CACf,CACL,EACAI,OAAAA,EAAAA,QAAQ,IAAM,CACLH,EAAK,QAAQ,WAEAE,EAAA,CAAA,EACnBJ,GAAQ,CAAA,CAAE,EACbM,EAAAA,UAAU,KACNJ,EAAK,QAAQ,UAAY,GACpBA,EAAK,QAAQ,iBACIE,EAAA,EACf,IAAM,CACTF,EAAK,QAAQ,UAAY,GACpBA,EAAK,QAAQ,kBAElBA,EAAK,QAAQ,gBAAgB,EAC7BA,EAAK,QAAQ,gBAAkB,OACnC,GACD,EAAE,EACEA,EAAK,QAAQ,IAAA,CAEjB,OAAAJ,CACX"}